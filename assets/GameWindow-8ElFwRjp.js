import{i as j,k as E,r as _,j as l,F as I,P as He,N as pe,z as A,R as M,Q as Z,_ as we,y as w,p as L,T as Fe,w as T,s as N,U as S,V as Re,x as b,W as ge,l as Ee,X as Ve,Y as Ge,Z as Ye,$ as Be,a0 as We,a1 as Ke,a2 as ze}from"./index-BS8tfVS8.js";import{g as Xe,c as _e,I as qe,b as Qe,s as Ze,d as Je,e as ve,t as xe,f as Ce,h as z}from"./spell-util-D9oSRjWt.js";import{T as J,I as et,u as ye,a as se,f as tt,C as nt,o as y,h as B,i as k,j as st,k as Ne,U as g,l as at,m as ot,n as it}from"./misc-util-D3JjVzwi.js";import{p as be,b as Te}from"./music-BPU2Vumq.js";function le(e,t){if(e==null)return{};var o={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;o[n]=e[n]}return o}function ie(e,t){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,n){return o.__proto__=n,o},ie(e,t)}function ce(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ie(e,t)}const rt="_window_1cf6a_1",lt={window:rt},ct="_bottom_1iroc_1",ut="_test_1iroc_10",dt={bottom:ct,test:ut},ft="_actions_c5y4z_1",mt="_spells_c5y4z_27",ht="_items_c5y4z_27",pt="_close_c5y4z_55",gt="_mana_c5y4z_70",Et="_icon_c5y4z_92",_t="_disabled_c5y4z_162",vt="_fadeIn_c5y4z_1",O={actions:ft,spells:mt,items:ht,close:pt,mana:gt,icon:Et,disabled:_t,"disabled-btn":"_disabled-btn_c5y4z_168",fadeIn:vt};function xt(){const e=j(),t=E(f=>f.dialogue.active),o=E(f=>f.ui.modalIsVisible),n=yt(),s=E(f=>f.combat.order).filter(f=>f.identifier!=="ENEMY"),a=E(f=>f.dungeon.event),r=a&&a.type==="ENTRANCE",i=E(f=>f.ui.spellListIsVisible),c=E(f=>f.player.spellList),u=E(f=>f.ui.itemListIsVisible),m=E(f=>f.player.id),h=E(f=>f.combat.isCharacterTurn===m),d=E(f=>f.dungeon.danger),x=!h&&d||a,[U,te]=_.useState("BEFORE COMBAT");_.useEffect(()=>{te(d?"DURING COMBAT":"BEFORE COMBAT")},[d]);const H=f=>{Je(f),f==="CAST SPELL"&&e(A.changeUi({element:"spellListIsVisible",visible:!0})),f==="USE ITEM"&&e(A.changeUi({element:"itemListIsVisible",visible:!0}))},me=(f,F)=>{ve(f),F==="spellListIsVisible"&&!d&&Qe(e,f),e(A.changeUi({element:F,visible:!1}))},he=f=>{ve(null),e(A.changeUi({element:f,visible:!1}))};let q;if(i){const f=n.currentMana;q=l.jsxs("div",{className:O.spells,children:[l.jsxs("div",{className:O.mana,children:[l.jsxs("span",{children:[l.jsx(I,{icon:He,className:O.icon}),n.currentMana," / ",n.stats.arcana.maxMana]}),l.jsx("progress",{max:n.stats.arcana.maxMana,value:n.currentMana,className:O.mana})]}),l.jsx("h3",{children:"Spell List"}),l.jsx("ul",{children:c.map(F=>{const p=Xe(F),Q=Ct(F),ne=Ze[Q],Ue=ne(n.stats.arcana.spellPower);return l.jsx(J,{title:p.name,text:p.school,detailOne:Ue,detailTwo:`Mana Cost: ${p.manaCost}`,position:"skill",container:"spell-list-container",children:l.jsx(et,{onClick:()=>me(p,"spellListIsVisible"),style:{backgroundImage:`url(${p.image})`,opacity:f>=p.manaCost&&p.spellType!=="SUMMON"&&(p.castTime===U||p.castTime==="ANYTIME")||p.spellType==="SUMMON"&&_e(p)||p.spellType==="SUMMON"&&s.length<3?"1":"0.6",pointerEvents:f>=p.manaCost&&p.spellType!=="SUMMON"&&(p.castTime===U||p.castTime==="ANYTIME")||p.spellType==="SUMMON"&&_e(p)||p.spellType==="SUMMON"&&s.length<3?"auto":"none"}},p.name)},p.name)})}),l.jsx(I,{icon:pe,onClick:()=>he("spellListIsVisible"),className:O.close})]})}else if(u){let f=[];n.inventory.consumables.map(p=>{let Q=f.find(ne=>ne.name===p.name);Q?Q.counter++:f.push({...p,counter:1})}),q=l.jsxs("div",{className:O.items,children:[l.jsx("h3",{children:"Item List"}),l.jsx("ul",{children:f.map(p=>{if(p.useInCombat)return l.jsx(qe,{item:p,count:p.counter,onClick:()=>me(p,"itemListIsVisible")},p.id)})}),l.jsx(I,{icon:pe,onClick:()=>he("itemListIsVisible"),className:O.close})]})}else q=l.jsxs("div",{className:O.actions,children:[(!x||r)&&l.jsx("button",{disabled:x,onClick:()=>H("CAST SPELL"),className:x?O["disabled-btn"]:"",children:"Cast Spell"}),!x&&h&&l.jsx("button",{disabled:x||!h,onClick:()=>H("ATTACK"),className:x||!h?O["disabled-btn"]:"",children:"Attack"}),!x&&h&&l.jsx("button",{disabled:x||!h,onClick:()=>H("GUARD"),className:x||!h?O["disabled-btn"]:"",children:"Guard"}),!x&&h&&l.jsx("button",{disabled:x||!h,onClick:()=>H("USE ITEM"),className:x||!h?O["disabled-btn"]:"",children:"Use Item"})]});if(!a)return!t&&!o&&(d&&h||!d)&&q}function Ct(e){return e.toUpperCase().replace(/\s+/g,"_")}const yt=()=>E(t=>t.combat.order).find(t=>t.id==="Player"),Nt="_party_pajil_1",bt={party:Nt},Tt="_character_mhu85_2",St="_enemy_mhu85_12",At="_image_mhu85_16",Ot="_fadeIn_mhu85_1",Lt="_highlighted_mhu85_73",It="_turn_mhu85_77",Mt="_container_mhu85_81",wt="_statusEffects_mhu85_97",Rt="_heroContainer_mhu85_118",jt="_enemyContainer_mhu85_122",kt="_heroStatusEffects_mhu85_149",Dt="_effect_mhu85_154",$t="_name_mhu85_180",Pt="_enemyName_mhu85_185",Ut="_info_mhu85_189",Ht="_heroInfo_mhu85_196",Ft="_enemyInfo_mhu85_200",Vt="_health_mhu85_236",v={character:Tt,enemy:St,image:At,fadeIn:Ot,"character-fading":"_character-fading_mhu85_43",highlighted:Lt,turn:It,container:Mt,statusEffects:wt,heroContainer:Rt,enemyContainer:jt,heroStatusEffects:kt,effect:Dt,name:$t,enemyName:Pt,info:Ut,heroInfo:Ht,enemyInfo:Ft,health:Vt,"effect-stack":"_effect-stack_mhu85_245"};function Gt(e,t){return e.classList?!!t&&e.classList.contains(t):(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")!==-1}function Yt(e,t){e.classList?e.classList.add(t):Gt(e,t)||(typeof e.className=="string"?e.className=e.className+" "+t:e.setAttribute("class",(e.className&&e.className.baseVal||"")+" "+t))}function Se(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function Bt(e,t){e.classList?e.classList.remove(t):typeof e.className=="string"?e.className=Se(e.className,t):e.setAttribute("class",Se(e.className&&e.className.baseVal||"",t))}const Ae={disabled:!1},ee=M.createContext(null);var je=function(t){return t.scrollTop},X="unmounted",D="exited",$="entering",Y="entered",re="exiting",R=function(e){ce(t,e);function t(n,s){var a;a=e.call(this,n,s)||this;var r=s,i=r&&!r.isMounting?n.enter:n.appear,c;return a.appearStatus=null,n.in?i?(c=D,a.appearStatus=$):c=Y:n.unmountOnExit||n.mountOnEnter?c=X:c=D,a.state={status:c},a.nextCallback=null,a}t.getDerivedStateFromProps=function(s,a){var r=s.in;return r&&a.status===X?{status:D}:null};var o=t.prototype;return o.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},o.componentDidUpdate=function(s){var a=null;if(s!==this.props){var r=this.state.status;this.props.in?r!==$&&r!==Y&&(a=$):(r===$||r===Y)&&(a=re)}this.updateStatus(!1,a)},o.componentWillUnmount=function(){this.cancelNextCallback()},o.getTimeouts=function(){var s=this.props.timeout,a,r,i;return a=r=i=s,s!=null&&typeof s!="number"&&(a=s.exit,r=s.enter,i=s.appear!==void 0?s.appear:r),{exit:a,enter:r,appear:i}},o.updateStatus=function(s,a){if(s===void 0&&(s=!1),a!==null)if(this.cancelNextCallback(),a===$){if(this.props.unmountOnExit||this.props.mountOnEnter){var r=this.props.nodeRef?this.props.nodeRef.current:Z.findDOMNode(this);r&&je(r)}this.performEnter(s)}else this.performExit();else this.props.unmountOnExit&&this.state.status===D&&this.setState({status:X})},o.performEnter=function(s){var a=this,r=this.props.enter,i=this.context?this.context.isMounting:s,c=this.props.nodeRef?[i]:[Z.findDOMNode(this),i],u=c[0],m=c[1],h=this.getTimeouts(),d=i?h.appear:h.enter;if(!s&&!r||Ae.disabled){this.safeSetState({status:Y},function(){a.props.onEntered(u)});return}this.props.onEnter(u,m),this.safeSetState({status:$},function(){a.props.onEntering(u,m),a.onTransitionEnd(d,function(){a.safeSetState({status:Y},function(){a.props.onEntered(u,m)})})})},o.performExit=function(){var s=this,a=this.props.exit,r=this.getTimeouts(),i=this.props.nodeRef?void 0:Z.findDOMNode(this);if(!a||Ae.disabled){this.safeSetState({status:D},function(){s.props.onExited(i)});return}this.props.onExit(i),this.safeSetState({status:re},function(){s.props.onExiting(i),s.onTransitionEnd(r.exit,function(){s.safeSetState({status:D},function(){s.props.onExited(i)})})})},o.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},o.safeSetState=function(s,a){a=this.setNextCallback(a),this.setState(s,a)},o.setNextCallback=function(s){var a=this,r=!0;return this.nextCallback=function(i){r&&(r=!1,a.nextCallback=null,s(i))},this.nextCallback.cancel=function(){r=!1},this.nextCallback},o.onTransitionEnd=function(s,a){this.setNextCallback(a);var r=this.props.nodeRef?this.props.nodeRef.current:Z.findDOMNode(this),i=s==null&&!this.props.addEndListener;if(!r||i){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var c=this.props.nodeRef?[this.nextCallback]:[r,this.nextCallback],u=c[0],m=c[1];this.props.addEndListener(u,m)}s!=null&&setTimeout(this.nextCallback,s)},o.render=function(){var s=this.state.status;if(s===X)return null;var a=this.props,r=a.children;a.in,a.mountOnEnter,a.unmountOnExit,a.appear,a.enter,a.exit,a.timeout,a.addEndListener,a.onEnter,a.onEntering,a.onEntered,a.onExit,a.onExiting,a.onExited,a.nodeRef;var i=le(a,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return M.createElement(ee.Provider,{value:null},typeof r=="function"?r(s,i):M.cloneElement(M.Children.only(r),i))},t}(M.Component);R.contextType=ee;R.propTypes={};function V(){}R.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:V,onEntering:V,onEntered:V,onExit:V,onExiting:V,onExited:V};R.UNMOUNTED=X;R.EXITED=D;R.ENTERING=$;R.ENTERED=Y;R.EXITING=re;const Wt=R;var Kt=function(t,o){return t&&o&&o.split(" ").forEach(function(n){return Yt(t,n)})},ae=function(t,o){return t&&o&&o.split(" ").forEach(function(n){return Bt(t,n)})},ue=function(e){ce(t,e);function t(){for(var n,s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return n=e.call.apply(e,[this].concat(a))||this,n.appliedClasses={appear:{},enter:{},exit:{}},n.onEnter=function(i,c){var u=n.resolveArguments(i,c),m=u[0],h=u[1];n.removeClasses(m,"exit"),n.addClass(m,h?"appear":"enter","base"),n.props.onEnter&&n.props.onEnter(i,c)},n.onEntering=function(i,c){var u=n.resolveArguments(i,c),m=u[0],h=u[1],d=h?"appear":"enter";n.addClass(m,d,"active"),n.props.onEntering&&n.props.onEntering(i,c)},n.onEntered=function(i,c){var u=n.resolveArguments(i,c),m=u[0],h=u[1],d=h?"appear":"enter";n.removeClasses(m,d),n.addClass(m,d,"done"),n.props.onEntered&&n.props.onEntered(i,c)},n.onExit=function(i){var c=n.resolveArguments(i),u=c[0];n.removeClasses(u,"appear"),n.removeClasses(u,"enter"),n.addClass(u,"exit","base"),n.props.onExit&&n.props.onExit(i)},n.onExiting=function(i){var c=n.resolveArguments(i),u=c[0];n.addClass(u,"exit","active"),n.props.onExiting&&n.props.onExiting(i)},n.onExited=function(i){var c=n.resolveArguments(i),u=c[0];n.removeClasses(u,"exit"),n.addClass(u,"exit","done"),n.props.onExited&&n.props.onExited(i)},n.resolveArguments=function(i,c){return n.props.nodeRef?[n.props.nodeRef.current,i]:[i,c]},n.getClassNames=function(i){var c=n.props.classNames,u=typeof c=="string",m=u&&c?c+"-":"",h=u?""+m+i:c[i],d=u?h+"-active":c[i+"Active"],x=u?h+"-done":c[i+"Done"];return{baseClassName:h,activeClassName:d,doneClassName:x}},n}var o=t.prototype;return o.addClass=function(s,a,r){var i=this.getClassNames(a)[r+"ClassName"],c=this.getClassNames("enter"),u=c.doneClassName;a==="appear"&&r==="done"&&u&&(i+=" "+u),r==="active"&&s&&je(s),i&&(this.appliedClasses[a][r]=i,Kt(s,i))},o.removeClasses=function(s,a){var r=this.appliedClasses[a],i=r.base,c=r.active,u=r.done;this.appliedClasses[a]={},i&&ae(s,i),c&&ae(s,c),u&&ae(s,u)},o.render=function(){var s=this.props;s.classNames;var a=le(s,["classNames"]);return M.createElement(Wt,we({},a,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},t}(M.Component);ue.defaultProps={classNames:""};ue.propTypes={};const zt=ue;function Xt(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function de(e,t){var o=function(a){return t&&_.isValidElement(a)?t(a):a},n=Object.create(null);return e&&_.Children.map(e,function(s){return s}).forEach(function(s){n[s.key]=o(s)}),n}function qt(e,t){e=e||{},t=t||{};function o(m){return m in t?t[m]:e[m]}var n=Object.create(null),s=[];for(var a in e)a in t?s.length&&(n[a]=s,s=[]):s.push(a);var r,i={};for(var c in t){if(n[c])for(r=0;r<n[c].length;r++){var u=n[c][r];i[n[c][r]]=o(u)}i[c]=o(c)}for(r=0;r<s.length;r++)i[s[r]]=o(s[r]);return i}function P(e,t,o){return o[t]!=null?o[t]:e.props[t]}function Qt(e,t){return de(e.children,function(o){return _.cloneElement(o,{onExited:t.bind(null,o),in:!0,appear:P(o,"appear",e),enter:P(o,"enter",e),exit:P(o,"exit",e)})})}function Zt(e,t,o){var n=de(e.children),s=qt(t,n);return Object.keys(s).forEach(function(a){var r=s[a];if(_.isValidElement(r)){var i=a in t,c=a in n,u=t[a],m=_.isValidElement(u)&&!u.props.in;c&&(!i||m)?s[a]=_.cloneElement(r,{onExited:o.bind(null,r),in:!0,exit:P(r,"exit",e),enter:P(r,"enter",e)}):!c&&i&&!m?s[a]=_.cloneElement(r,{in:!1}):c&&i&&_.isValidElement(u)&&(s[a]=_.cloneElement(r,{onExited:o.bind(null,r),in:u.props.in,exit:P(r,"exit",e),enter:P(r,"enter",e)}))}}),s}var Jt=Object.values||function(e){return Object.keys(e).map(function(t){return e[t]})},en={component:"div",childFactory:function(t){return t}},fe=function(e){ce(t,e);function t(n,s){var a;a=e.call(this,n,s)||this;var r=a.handleExited.bind(Xt(a));return a.state={contextValue:{isMounting:!0},handleExited:r,firstRender:!0},a}var o=t.prototype;return o.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},o.componentWillUnmount=function(){this.mounted=!1},t.getDerivedStateFromProps=function(s,a){var r=a.children,i=a.handleExited,c=a.firstRender;return{children:c?Qt(s,i):Zt(s,r,i),firstRender:!1}},o.handleExited=function(s,a){var r=de(this.props.children);s.key in r||(s.props.onExited&&s.props.onExited(a),this.mounted&&this.setState(function(i){var c=we({},i.children);return delete c[s.key],{children:c}}))},o.render=function(){var s=this.props,a=s.component,r=s.childFactory,i=le(s,["component","childFactory"]),c=this.state.contextValue,u=Jt(this.state.children).map(r);return delete i.appear,delete i.enter,delete i.exit,a===null?M.createElement(ee.Provider,{value:c},u):M.createElement(ee.Provider,{value:c},M.createElement(a,i,u))},t}(M.Component);fe.propTypes={};fe.defaultProps=en;const tn=fe,nn="_damage_163fd_1",sn="_heal_163fd_57",an="_burning_163fd_84",on="_chilled_163fd_94",rn="_poisoned_163fd_103",ln="_stunned_163fd_114",cn="_diseased_163fd_125",un="_haunted_163fd_126",dn="_cursed_163fd_131",fn="_withered_163fd_132",mn="_restrained_163fd_133",G={"damage-display":"_damage-display_163fd_1","damage-enter":"_damage-enter_163fd_24","damage-enter-active":"_damage-enter-active_163fd_29","damage-exit":"_damage-exit_163fd_35","damage-exit-active":"_damage-exit-active_163fd_40",damage:nn,heal:sn,"heal-effect":"_heal-effect_163fd_1","gain-mana":"_gain-mana_163fd_63",burning:an,"fire-damage":"_fire-damage_163fd_90",chilled:on,"ice-damage":"_ice-damage_163fd_99",poisoned:rn,"poison-damage":"_poison-damage_163fd_110",stunned:ln,"lightning-damage":"_lightning-damage_163fd_121","damage-shake":"_damage-shake_163fd_1",diseased:cn,haunted:un,cursed:dn,withered:fn,restrained:mn},hn=_.memo(({character:e})=>{const t=j();return _.useEffect(()=>{const o=setTimeout(()=>{t(w.removeDamageDisplayItem({id:e.id}))},1e3);return()=>{clearTimeout(o)}},[e.damageDisplay,t,e.id]),l.jsx(tn,{component:"ul",className:G["damage-display"],children:e.damageDisplay.slice().reverse().map(o=>l.jsx(zt,{timeout:500,classNames:{enter:G["damage-enter"],enterActive:G["damage-enter-active"],exit:G["damage-exit"],exitActive:G["damage-exit-active"]},children:l.jsx("li",{className:G[o.style],children:o.item})},o.id))})});function ke({character:e}){const t=j(),o=E(d=>d.combat.order),n=o.findIndex(d=>d.id===e.id);e=o[n];const s=E(d=>d.combat.highlightedCharacter===e.id),a=E(d=>d.combat.isCharacterTurn),[r,i]=_.useState(!1);_.useEffect(()=>{e.identifier==="ENEMY"&&e.audio&&L(...e.audio.spawn)},[]),_.useEffect(()=>{ye(t,e.id)},[e]),_.useEffect(()=>{ye(t,e.id)},[e.level]);const c=()=>{xe==="ALLIES"&&(e.identifier==="HERO"||e.identifier==="PLAYER")&&Ce(e),xe==="ENEMIES"&&e.identifier==="ENEMY"&&Ce(e)};_.useEffect(()=>{e.currentHealth<=0&&(e.id!=="Player"&&pn(t,e),setTimeout(()=>{e.audio&&L(...e.audio.death),i(!0)},1e3))},[e.currentHealth,t,e.id]);const u=l.jsxs("div",{className:`${v.container} ${e.identifier==="ENEMY"?v.enemyContainer:v.heroContainer}`,children:[l.jsx("p",{className:`${v.name} ${e.identifier==="ENEMY"?v.enemyName:""}`,children:e.name}),l.jsxs("div",{className:v.health,children:[l.jsx("div",{className:`${v.info} ${e.identifier==="ENEMY"?v.enemyInfo:v.heroInfo}`,children:l.jsxs("p",{children:[l.jsx(I,{icon:Fe})," ",e.currentHealth,"/",e.stats.strength.maxHealth]})}),l.jsx("progress",{max:e.stats.strength.maxHealth,value:e.currentHealth,children:"Health Bar"})]}),l.jsx("div",{className:`${v.statusEffects} ${e.identifier!=="ENEMY"?v.heroStatusEffects:""}`,children:e.statusEffects.map(d=>{if(d.display){e.identifier;let x;d.durationType==="ROUND"?x=`Duration: ${d.duration} ${d.duration>1?"rounds":"round"}`:d.durationType==="ROOM"&&(x=`Duration: ${d.duration} ${d.duration>1?"rooms":"room"}`);let U;return"stack"in d?U=!0:U=!1,l.jsxs(J,{title:d.name,text:d.description,detailOne:x,detailTwo:d.effect?d.effect.map((te,H)=>l.jsx("span",{children:te},H)):null,position:"effect",children:[l.jsx("div",{className:v.effect,style:{backgroundImage:`url(${d.image})`}}),U&&d.stack>1&&l.jsxs("p",{className:v["effect-stack"],children:["x",d.stack]})]},d.name)}})})]}),m=l.jsxs("div",{className:`${v.image} ${s?v.highlighted:""} ${a===e.id?v.turn:""}`,children:[l.jsx("img",{src:`${e.image}.png`,alt:e.name}),l.jsx(hn,{character:e})]});let h;return e.identifier==="HERO"||e.identifier==="PLAYER"?h=l.jsxs(l.Fragment,{children:[m,u]}):e.identifier==="ENEMY"&&(h=l.jsxs(l.Fragment,{children:[u,m]})),l.jsx("div",{className:`${v.character} ${e.identifier==="ENEMY"?v.enemy:""} ${r?v["character-fading"]:""}`,onClick:c,children:h})}async function pn(e,t){setTimeout(()=>{e(w.removeCharacter({character:t}))},2e3)}function gn(){const e=E(t=>t.combat.order);return l.jsx("div",{className:bt.party,children:e.map(t=>{if(t.identifier==="HERO"||t.identifier==="PLAYER")return l.jsx(ke,{character:t},t.id)})})}const En="_enemies_756kh_1",_n={enemies:En};function vn(){const e=E(t=>t.combat.order);return l.jsx("div",{className:_n.enemies,children:e.map(t=>{if(t.identifier==="ENEMY")return l.jsx(ke,{character:t},t.id)})})}function xn(){return l.jsxs("div",{className:dt.bottom,children:[l.jsx(gn,{}),l.jsx(xt,{}),l.jsx(vn,{})]})}const Cn="_middle_udcmk_1",Oe={middle:Cn,continue:"_continue_udcmk_11"},yn="_events_1isdd_1",Nn="_fadeIn_1isdd_1",bn={events:yn,fadeIn:Nn},De={DUNGEON_ENTRANCE_ENTER:async e=>{await $e(e),e(T.updateLogs({change:"UNPAUSE"})),e(T.updateLogs({change:"CLEAR"}))},TRAP:async(e,t)=>{const n=N.getState().combat.order.find(u=>u.id==="Player"),s=N.getState().dungeon;let a,r;s.threat>50?(a=20,r=40):s.threat>40?(a=18,r=30):s.threat>30?(a=16,r=20):s.threat>20?(a=14,r=15):s.threat>10?(a=12,r=10):(a=10,r=10);const i=Tn(e,n,a,t),c=s.contents.event.name;i||(se(e,n,"DAMAGE",r),(c==="Poison Darts"||c==="Poisonous Mist")&&tt(e,n,"ADD",nt.POISONED)),c==="Poison Darts"&&!i&&L(!1,"bowAttack","bulletsImpactFlesh26"),c==="Poison Darts"&&i&&L(!1,"bowAttack","bulletsPassBy4"),await C(4e3),y(e,"roomSummaryModal")},COFFIN:async(e,t)=>{const o=N.getState().dungeon,n=Math.random()*100;let s;if(o.threat>40?s=g.DEATH_KNIGHT:o.threat>30?s=g.GRAVE_WITCH:o.threat>20?s=g.BONE_TITAN:o.threat>10?s=g.CORPSE_ORACLE:s=g.SKELETAL_WARRIOR,t==="Open")if(L(!1,"misc","openCoffin"),B(e),n<=30)await S(e,"after",t),await C(2e3),y(e,"roomSummaryModal");else{await S(e,"response",t),Re(e,"after",t);const a=k(s);e(b.addEnemy({enemy:a,change:"ADD"})),await C(2e3),z(e,[a])}t==="Leave"&&(await S(e,"after",t),await C(2e3),y(e,"roomSummaryModal"))},GRAVESTONE:async(e,t)=>{const o=N.getState().combat.order.find(n=>n.id==="Player");if(t==="Place a flower"){const n=["Gravebloom","Gravelight Lily","Witchfire Orchid","Sunshade Blossom"],s=o.inventory.consumables.find(a=>n.includes(a.name));e(w.changePlayerInventory({change:"REMOVE",item:s})),await S(e,"after",t),L(!1,"death","wispDeath",1.2),e(b.beginFollowing({following:"Wandering Wisp",rooms:st("Wandering Wisp")})),await C(2e3),y(e,"roomSummaryModal")}t==="Leave"&&(await C(1e3),await S(e,"after",t),await C(2e3),y(e,"roomSummaryModal"))},PATH_ENTRANCE:async(e,t)=>{const o=N.getState().dungeon.contents.event.name;if(t==="Enter"){e(b.eventOutcome({outcome:`You entered ${o}.`})),e(b.beginPath(o)),L(!0,"openDoor"),await e(A.updateFade({change:"CALL"})),await C(2e3);const n=o.toLowerCase().replace(/ /g,"-").replace(/'/g,""),s=Ne(`/assets/images/backgrounds/${n}/${n}`,8);e(b.changeBackground(s)),await e(A.updateFade({change:"CLEAR"})),await Pe(e,o),await S(e,"response",t)}else await C(4e3),y(e,"roomSummaryModal");await C(4e3),e(b.endFollowing()),y(e,"roomSummaryModal")},PATH_EXIT:async(e,t)=>{const o=N.getState().dungeon.path;t==="Leave"&&(L(!0,"openDoor"),e(b.eventOutcome({outcome:`You left ${o}.`})),await C(4e3),e(b.endPath()),y(e,"roomSummaryModal"))},BONEVAULT:async(e,t)=>{const o=N.getState().combat.order,n=N.getState().dungeon,a=o.find(c=>c.id==="Player").inventory.consumables.find(c=>c.name==="Skeleton Key");let r,i=[];if(t==="Unlock"){if(!a)e(T.updateLogs({change:"ADD",text:"You don't have a key to this door."})),e(b.eventOutcome({outcome:"You were unable to unlock the door."})),await C(4e3),y(e,"roomSummaryModal");else if(a){L(!1,"item","skeltonKey"),L(!0,"openDoor"),e(w.changePlayerInventory({item:a,change:"REMOVE"})),B(e),await e(A.updateFade({change:"CALL"})),await C(2e3);const c=Ne("/assets/images/backgrounds/events/bonevault-room",4);e(b.changeBackground(c)),await e(A.updateFade({change:"CLEAR"}));const u=Math.floor(Math.random()*4)+1;be(Te.warningSignal),n.threat>50?r=[g.DEATH_KNIGHT,g.DEATH_KNIGHT,g.GRAVE_WITCH]:n.threat>40?r=[g.GRAVE_WITCH,g.BONE_TITAN,g.REAPER]:n.threat>30?r=[g.BONE_TITAN,g.REAPER,g.CORPSE_ORACLE]:n.threat>20?r=[g.CORPSE_ORACLE,g.SKELETAL_MAGE,BONE_TITAN]:n.threat>10?r=[g.CORPSE_ORACLE,g.SKELETAL_MAGE,g.SKELETAL_ARCHER,g.SKELETAL_WARRIOR]:r=[g.DECREPIT_SKELETON,g.DECREPIT_SKELETON,g.SKELETAL_MAGE,g.SKELETAL_ARCHER,g.SKELETAL_WARRIOR];for(let m=0;m<u;m++){const h=Math.floor(Math.random()*r.length);i.push(k(r[h]))}await C(2e3),z(e,i),e(b.eventOutcome({outcome:"You chose to unlock the door and enter."}))}}else t==="Leave"&&(e(b.eventOutcome({outcome:"You chose not to enter."})),await C(4e3),y(e,"roomSummaryModal"))},UNLOCK_HERO_LIHETH:async(e,t)=>{const o=N.getState().combat.order;ge(e,2e3);for(let n=0;n<o.length;n++){const s=o[n].stats.strength.maxHealth,a=Math.round(s/2);se(e,o[n],"HEAL",a)}e(Ee.unlockHero("Liheth")),B(e),await S(e,"after",t),y(e,"roomSummaryModal")},CANDLELIGHT_SHRINE:async(e,t)=>{if(t==="Rest"){const o=N.getState().combat.order;ge(e,2e3);for(let n=0;n<o.length;n++){const s=o[n].stats.strength.maxHealth,a=Math.round(s/2);se(e,o[n],"HEAL",a)}B(e),await S(e,"after",t),y(e,"roomSummaryModal")}},UNLOCK_HERO_SIGGURD:async e=>{Le(e);let t=[k(g.DECREPIT_SKELETON),k(g.DECREPIT_SKELETON),k(g.DECREPIT_SKELETON),k(g.DECREPIT_SKELETON),k(g.DECREPIT_SKELETON)];e(Ee.unlockHero("Siggurd")),z(e,t)},AMBUSH:async(e,t)=>{const o=N.getState().dungeon,s=N.getState().combat.order.find(a=>a.id==="Player");if(t==="Surrender"){if(s.inventory.consumables.length!==0&&s.inventory.equipment.length!==0){for(let r=0;r<2;r++){const i=Math.floor(Math.random())*s.inventory.consumables.length;e(w.changePlayerInventory({item:s.inventory.consumables[i],change:"REMOVE"}))}const a=Math.floor(Math.random())*s.inventory.equipment.length;e(w.changePlayerInventory({item:s.inventory.equipment[a],change:"REMOVE"})),await S(e,"after",t),await C(2e3)}Le(e),y(e,"roomSummaryModal")}t==="Refuse"&&(await S(e,"response",t),B(e),z(e,o.contents.enemies),be(Te.hiddenCapacity))},LAUGHING_COFFIN:async(e,t)=>{t==="Trade"?(await S(e,"response",t),y(e,"tradeModal")):t==="Leave"&&(await S(e,"after",t),y(e,"roomSummaryModal"))}};async function Tn(e,t,o,n){let s;n==="(Strength)"?s=t.stats.strength.totalStrength:n==="(Agility)"&&(s=t.stats.agility.totalAgility),s+=at(e,"Evertorch");const a=Sn(s);return await C(1e3),a>o?(e(T.updateLogs({change:"ADD",text:"Success!"})),e(b.eventOutcome({outcome:"You successfully overcame the trap."})),!0):(e(T.updateLogs({change:"ADD",text:"Fail!"})),e(b.eventOutcome({outcome:"You failed to overcome the trap."})),!1)}function Sn(e=0){return Math.floor(Math.random()*21)+e}async function C(e){return new Promise(t=>setTimeout(t,e))}function Le(e){const t=N.getState().combat.order;for(let o=0;o<t.length;o++)t[o].identifier!=="PLAYER"&&t[o].identifier!=="HERO"&&e(w.removeCharacter({character:t[o]}))}function An(){const e=j(),t=E(i=>i.dungeon),o=t.contents.event.type==="TRAP",n=t.contents.event.type==="AUTO";let s=[];if(t.contents.event){s=On(t.contents.event);for(let i=0;i<t.contents.event.options.length;i++)s.push(t.contents.event.options[i])}const a=(i,c,u,m)=>{t.contents.event.type!=="TRADE"&&i(A.changeUi({element:"eventOptionsAreVisible",visible:!1})),i(b.eventOutcome({outcome:m.outcome})),i(T.updateLogs({change:"UNPAUSE"})),i(T.updateLogs({change:"CLEAR"})),i(T.updateLogs({change:"ADD",text:m.narration})),c(i,u),Re(i,"after",u)};let r;return n||(r=l.jsx(l.Fragment,{children:s.map(i=>{const c=De[i.function];let u;return o?u=i.text[1]:u=i.text[0],l.jsx("button",{onClick:()=>a(e,c,u,i),children:Array.isArray(i.text)?i.text.map((m,h)=>l.jsx("span",{style:{display:"block"},children:m},h)):l.jsx("span",{children:i.text})},i.text)})})),l.jsx("div",{className:bn.events,children:r})}function On(e){const t=N.getState().combat.order.find(n=>n.id==="Player");let o=[];switch(e.name){case"Gravestone":{const n=["Gravebloom","Gravelight Lily","Witchfire Orchid","Sunshade Blossom"];t.inventory.consumables.some(a=>n.includes(a.name))&&o.push({text:["Place a flower"],function:"GRAVESTONE",narration:"You place a flower on the gravestone.",outcome:"You placed a flower on the gravestone and a wisp emerged from its rest to guide you."})}break}return o}function Ln(){const e=j(),t=E(s=>s.ui.eventOptionsAreVisible),o=E(s=>s.ui.continueIsVisible),n=()=>{e(A.changeUi({element:"continueIsVisible",visible:!1})),$e(e)};return l.jsxs("div",{className:Oe.middle,children:[o&&l.jsx(I,{className:Oe.continue,icon:Ve,onClick:n}),t&&l.jsx(An,{})]})}async function $e(e){await e(A.updateFade({change:"CALL"})),L(!1,"misc","whooshLowAir"),await t(3e3),e(A.changeUi({element:"modalIsVisible",visible:!1})),ot(e),await e(A.updateFade({change:"CLEAR"}));async function t(o){return new Promise(n=>setTimeout(n,o))}}const In="_top_12q9a_1",Mn="_topContent_12q9a_5",Ie={top:In,topContent:Mn},wn="_info_1k23i_1",Rn={info:wn};function jn(){const e=E(t=>t.dungeon);return l.jsxs("div",{className:Rn.info,children:[l.jsx("h2",{children:e.name}),l.jsxs("h4",{children:["Rooms Cleared: ",e.roomCounter]})]})}const kn="_tracker_1kphi_1",Dn={tracker:kn},$n="_highlighted_1rp0y_1",Pn="_icon_1rp0y_10",Un="_turn_1rp0y_19",oe={highlighted:$n,icon:Pn,turn:Un},Hn=({character:e})=>{const t=j(),o=E(r=>r.combat.highlightedCharacter===e.id),n=E(r=>r.combat.isCharacterTurn===e.id),s=()=>{t(w.highlightCharacter(e.id))},a=()=>{t(w.clearHighlight())};return l.jsx("div",{className:`${o?oe.highlighted:oe.icon} ${n?oe.turn:""}`,style:{backgroundImage:`url(${e.icon}.png)`},onMouseEnter:s,onMouseLeave:a})},Fn=_.memo(Hn);function Vn(){const e=E(s=>s.combat.order),t=E(s=>s.combat.isCharacterTurn);let n=(s=>e.find(a=>a.id===s))(t);return n||(n=""),l.jsxs("div",{className:Dn.tracker,children:[e.map((s,a)=>l.jsx(Fn,{character:s},a)),t&&l.jsx("p",{children:`${n.name}'s Turn!`})]})}const Gn="_container_xauf0_1",Yn="_skull_xauf0_15",Bn="_following_xauf0_26",Wn="_icon_xauf0_38",Kn="_number_xauf0_21",W={container:Gn,skull:Yn,following:Bn,icon:Wn,number:Kn};function zn(){const e=E(o=>o.dungeon),t=E(o=>o.dungeon.threat);return l.jsxs("div",{className:W.container,children:[e.followCounter>0&&l.jsx("div",{className:W.icon,children:l.jsx(J,{position:"bottom-left",title:"Following",text:e.following,detailOne:`${e.followCounter>1?`${e.followCounter} rooms`:`${e.followCounter} room`} away.`,children:l.jsx(I,{icon:Ge,className:W.following})})}),l.jsx("div",{className:W.icon,children:l.jsx(J,{position:"bottom-left",title:"Threat",text:t,detailOne:"Threat determines the difficulty of the encounters you will face. Threat is raised after each cleared room, when you fail to cast a spell, and in other specific instances.",children:l.jsx(I,{icon:Ye,className:W.skull})})})]})}function Xn(){return l.jsx("div",{className:Ie.top,children:l.jsxs("div",{className:Ie.topContent,children:[l.jsx(jn,{}),l.jsx(Vn,{}),l.jsx(zn,{})]})})}const qn="_buttons_1ye33_1",Qn="_icon_1ye33_14",Zn="_fadeIn_1ye33_1",K={buttons:qn,icon:Qn,fadeIn:Zn};function Jn(){const e=j(),t=E(s=>s.dialogue.active),o=E(s=>s.dungeon.danger),n=s=>{y(e,s)};return!t&&l.jsxs("div",{className:K.buttons,children:[l.jsx(I,{className:K.icon,icon:Be,onClick:()=>n("inventoryModal"),style:o?{pointerEvents:"none",opacity:.6}:{}}),l.jsx(I,{className:K.icon,icon:We,onClick:()=>n("questsModal")})," ",l.jsx(I,{className:K.icon,icon:Ke,onClick:()=>n("dungeonTomesModal")}),l.jsx(I,{className:K.icon,icon:ze,onClick:()=>n("settingsModal")})]})}const os=_.memo(()=>{const[e,t]=_.useState(!0),o=j(),{roomCounter:n,image:s}=E(a=>a.dungeon);return _.useEffect(()=>{es(o,t)},[n]),l.jsxs("div",{className:lt.window,style:{backgroundImage:`url(${s}.jpg)`},children:[l.jsx(Xn,{}),l.jsx(Ln,{}),e&&l.jsx(xn,{}),e&&l.jsx(Jn,{})]})});async function es(e,t){const o=N.getState().dungeon,n=N.getState().dungeon.contents.event;if(o.roomCounter===0&&(t(!1),await Pe(e,o.name)),t(!0),n||(await S(e,"before"),z(e,o.contents.enemies)),n){if(n.characters)for(let s=0;s<n.characters.length;s++)it(e,n.characters[s]);if(await S(e,"before"),n.type==="AUTO"){const s=De[n.function];s(e),e(b.eventOutcome({outcome:n.outcome}))}e(T.updateLogs({change:"PAUSE"}));for(let s=0;s<n.description.length;s++)e(T.updateLogs({change:"ADD",text:n.description[s]}))}}async function Pe(e,t){e(T.updateLogs({change:"CLEAR"})),e(T.updateLogs({change:"PAUSE"})),await Me(2e3),L(!1,"misc","enterDungeon"),e(T.updateLogs({change:"ADD",text:`${t}`})),await Me(4e3),e(T.updateLogs({change:"UNPAUSE"})),e(T.updateLogs({change:"CLEAR"}))}async function Me(e){return new Promise(t=>setTimeout(t,e))}export{os as default,Pe as locationNarration};
